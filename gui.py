from telepot.namedtuple import (
    ReplyKeyboardMarkup, 
    KeyboardButton,
    InlineKeyboardMarkup,
    InlineKeyboardButton
)

from bot import write,write_location

def show_type_selection(data = None,session = None):
    """
    Show a message with keyboard to choose the desired shop type.
    data (dict): Data dict generated by read functions in bot.py
    session (dict): A dict representin the session or None if no session has been created

    return: message (dict, telegram message object https://core.telegram.org/bots/api#message) 
    """

    replyKeyboard = InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="ğŸ éºµåŒ…åº—",callback_data="type0")],
        [InlineKeyboardButton(text="â˜•ï¸ å’–å•¡å»³",callback_data="type1")],
        [InlineKeyboardButton(text="ğŸ› é¤å»³",callback_data="type2")],
        [InlineKeyboardButton(text="ğŸº é…’å§",callback_data="type3")],
    ])

    return write(data=data,msg="è¦é¸æ“‡ä»€éº¼é¡å‹çš„é£Ÿç‰©å‘¢ï¼Ÿ",keyboard=replyKeyboard,session=session)

def show_stores(session):
    """
    Show a message with keyboard to choose the desire store.

    session (dict): A dict representin the session

    return: message (dict, telegram message object https://core.telegram.org/bots/api#message)
    """

    inline_keyboard = []
    for i,restaurant in enumerate(session["result_list"]):
        inline_keyboard.append([InlineKeyboardButton(text="âœ”ï¸" +  restaurant['name'] +  "\n (" +  str(restaurant['dis']) +  "m)", callback_data="store" + str(i))])
    inline_keyboard.append([InlineKeyboardButton(text="â¤´ï¸ä¸Šä¸€é ",callback_data="return_to_type")])

    replyKeyboard = InlineKeyboardMarkup(inline_keyboard=inline_keyboard)

    return write(data = None, msg = "ä»¥ä¸‹ç‚ºè·é›¢æ‚¨æœ€è¿‘çš„ {} å®¶åº—å®¶ï¼š".format(len(session["result_list"])), keyboard = replyKeyboard,session = session)


def show_store_detail(session, index, with_keyboard = True):
    
    replyKeyboard = InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="â¤´ï¸ä¸Šä¸€é ",callback_data="return_to_stores")],
        [InlineKeyboardButton(text="ğŸ‘ŒOK",callback_data="OK" + str(index))]
    ])
    store = session["result_list"][index]

    return write(data = None, msg = "ä»¥ä¸‹ç‚ºæ­¤åº—å®¶çš„ç›¸é—œè³‡è¨Šï¼š\n"
				"ğŸ  åº—åï¼š" + store['name'] +  "\n"
				"ğŸ“ é›»è©±ï¼š" + store['tel'] + "\n"
                "ğŸš² è·é›¢ï¼š" + str(store['dis']) + "m\n"
                "ğŸ“ åœ°å€ï¼š" + store['add'] + "\n"
                "ğŸ“Š è©•ç­‰ï¼š" + "â­" * store["rating_rounded"] + store["rating_string"] + "\n"
                "â° ç‡Ÿæ¥­ï¼š" + store["open"] + "\n"
                ,keyboard = replyKeyboard if with_keyboard else None,session = session)    